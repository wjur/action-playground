  name: pr-artifact

  on: [pull_request]

  permissions: write-all

  jobs:
    generate-artifact:
      runs-on: ubuntu-20.04
      steps:
        - name: Checkout code
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
            ref: ${{ github.event.pull_request.head.sha }}
        - name: Analyze tags
          run: |
            current_coverage="${{ github.event.pull_request.title }}"
            last_coverage_tag=$(git describe --tags --abbrev=0 --match="coverage-*")
            echo "Last coverage tag = $last_coverage_tag"
            coverage="${last_coverage_tag##*-}"
            echo "Last coverage = $coverage"
            lowers_coverage=$(echo "$coverage > current_coverage" |bc -l)
            echo "lowers_coverage = lowers_coverage"

        - name: Add label to PR
          uses: actions/github-script@v7
          with:
            script: |
              github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: ['low-coverage']
              })
